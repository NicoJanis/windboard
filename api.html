<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>OpenWeatherMap Api</title>
    <link rel="stylesheet" href="css/stylesheet-api.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
	<link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet"> 
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
</head>

<body>

    <div class="main">
        <!-- set output value, dipslayed in html conatiner   -->
        <div class="container">

            <div class="app-wrap">
                <header>
                    <input type="text" autocomplete="off" class="search-box" placeholder="Search for a city..." />
                </header>
                <main>
					<div class="data">
						<section class="location">
							<div class="city">Vienna, AT</div>
							<div class="date">Sunday 10 January 2021</div>
						</section>
						<section class="current">
							<div class="temp">15<span>°C</span></div>
							<div class="hi-low">13 / 16</div>
							<div class="wind">15<span>kn</span></div>
							<div class="weather">Sunny</div>
						</section>
					</div>
					<div class="spacer">
						<div id="div0"></div>
						<div id="div1"></div>
					</div>
					<div class="map">
						<div id="map"></div>
					</div>
                </main>
            </div>

        </div>


        <script>
            var map = L.map('map').setView([50, 50], 2);
            L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=hYjlwswSlN8Zv1WWYFGT', {
                attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a><a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',
            }).addTo(map);

            var theMarker = {};

            const api = {
                key: "5f0ce22b4d50f95750ee5c6d75d04a19",
                base: "https://api.openweathermap.org/data/2.5/"
            }

            const searchbox = document.querySelector('.search-box');
            searchbox.addEventListener('keypress', setQuery);

            function setQuery(evt) {
                if (evt.keyCode == 13) {
                    getResults(searchbox.value);
                }
            }

            function getResults(query) {
                fetch(`${api.base}weather?q=${query}&units=metric&APPID=${api.key}`)
                    .then(weather => {
                        return weather.json();
                    }).then(displayResults);
            }

            function displayResults(weather) {
                let city = document.querySelector('.location .city');
                city.innerText = `${weather.name}, ${weather.sys.country}`;

                let now = new Date();
                let date = document.querySelector('.location .date');
                date.innerText = dateBuilder(now);

                let temp = document.querySelector('.current .temp');
                temp.innerHTML = `${Math.round(weather.main.temp)}<span>°C</span>`;

                let wind = document.querySelector('.current .wind');
                wind.innerHTML = weather.wind.speed + "<span>kn<span>";

                let weather_el = document.querySelector('.current .weather');
                weather_el.innerText = weather.weather[0].main;

                let hilow = document.querySelector('.hi-low');
                hilow.innerText = `${Math.round(weather.main.temp_min)} / ${Math.round(weather.main.temp_max)}`;


                var lonValue = weather.coord.lon;
                var latValue = weather.coord.lat;

                if (theMarker != undefined) {
                    map.removeLayer(theMarker);
                };

                theMarker = L.marker([latValue, lonValue]).addTo(map);
                theMarker.bindPopup(`${weather.name}, ${weather.sys.country}` + "<br>" + "Desc - " + weather.weather[0].main + "<br>" + "Temp - " + `${Math.round(weather.main.temp)}<span>°C</span>` + "<br>" + "Windspeed - " + weather.wind.speed + ' knots');


            }

            function dateBuilder(d) {
                let months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                let days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

                let day = days[d.getDay()];
                let date = d.getDate();
                let month = months[d.getMonth()];
                let year = d.getFullYear();

                return `${day} ${date} ${month} ${year}`;
            }


            function getLon() {
                text2: lonValue;
            }

            function getLat() {
                text1: latValue;
            }
        </script>



    </div>
    </div>




</body>

</html>